# RadioLook
Dynamic web page providing information for a number of internet radios

<img src="media/image1.jpeg" alt="LogoTU-BG-black" />

# КУРСОВ ПРОЕКТ

## Тема: Създаване на динамична интернет страница, състояща се от клиентска част (написана на HTML, CSS и JavaScript) и сървърна част, написана на Node.js.

### 1.  Проучване на проблемната област

Предметната област е свързана със
  създаването на **динамична интернет страница**, представяща подробна
  **информация за набор от интернет радиа**. Тази информация включва
  текущо изпълняваната песен, обложката на албума (ако е налична),
  броя на текущите слушатели, максималния брой слушатели за
  съответното радио. Предоставя се възможност за слушане на
  stream-овете на радиата както чрез външен плейър, така и чрез онлайн
  такъв, достъпен на самия сайт.

Като допълнителна функционалност са включени форма за контакт, чрез
която потребителите могат да изпращат своите въпроси и предложения,
отделна страница следяща текущия статус на използваните за извличане на
информацията сървъри, както и страница, посветена на пълното описание на
проекта. Съдържанието на уеб страницата се обновява динамично, като това
става автоматично през определен период от време. Извлечената информация
се съхранява в база данни.

### 2.  Цел и задачи на проекта

Да се представят част от възможностите на
библиотеката **Boostrap**, улесняваща оформянето на дизайна на
клиентската част, както и да се представи наборът от инструменти,
предлагани от средата за разработка **Express.js**, при оформянето
на сървърната част на сайта (т.нар. back end). Да се изследва
функционалността на релационната база данни **SQLite**, при която
цялата база данни е съсредоточена в един единствен файл, и
основанията за нейното използване в приложения, изискващи
едновременен достъп.

### 3.  Софтуерна разработка

Софтуерната разработка се състои от две
части - сървърна част (back end) и клиентска част (front end).

**Клиентската част** представлява съвкупността от динамично
генерираните **HTML** документи, **CSS** и **JavaScript** код, които
се визуализират от уеб-браузъра на потребителя и съставляват
потребителския интерфейс на приложението.

Сайтът е изграден от следните страници: основна страница
(**index.html**), която играе ролята на начална страница и съдържа
информацията за текущото състояние и времето на последен достъп до
сървърите и базата данни, като информацията се обновява динамично, без
да е нужно действие от страна на потребителя.

**RadioList.html**, на която е разположена таблица с информация за
достъпните радиа като лого, уебсайт, броят на текущите слушатели,
максималният брой слушатели, текущо изпълнявани песни, както и линкове
за сваляне на .m3u stream-овете за слушане във външен плейър.

Всяко едно от радиата има и своя собствена страница, изградена на
базата на **radioPage.html**. Тази страница визуализира обложката на
текущата песен и предоставя възможност за слушане на съответното ради
директно чрез вградения HTML5 радио плейър **Muses**. Достъпна е още и
таблица с последните 10 песни, като потребителят може да се върне и
по-назад в историята. Налице са удобни линкове за бързо търсене на
дадена песен в платформи като **Google**, **YouTube**, **Genius** и
**Spotify**. Автоматично се прави проверка дали текущата песен вече не
е различна. В случай, че това е така, тя се променя динамично без да
се изисква обновяване на страницата.

На страницата **feedback.html** потребителите могат да изпращат своята
обратна връзка, използвайки представената форма. Съобщението се
изпраща с **AJAX POST** заявка до сървъра, където се обработва.

Страницата **about.html** съдържа подробно описание на самия проект.

Основната част от дизайна на страниците е изградена с помощта на
средата **Bootstrap**, която съдържа набор от инструменти за създаване
и оформяне на уеб-сайтове. Всяка от страниците се състои от
навигационна лента (**Navbar**) в горната си част, даваща достъп до
останалите, както и т.нар. **Footer** в долната част, където е
разположена информация за автора.

За самото съдържание са използвани редица елементи, предлагани от
**Bootstrap**, като **Cards**, **Modals**, **Jumbotrons**,
**Popovers**. Отделните елементи са подредени в редове и колони спрямо
т.нар. **Grid Layout**, благодарение на който дизайнът на страницата
става динамичен и може да се променя според размера на екрана на
устройство на потребителя, изглеждайки еднакво добре както на десктоп
компютри, така и на мобилни телефони.

Към някои от страниците са свързани и .css файлове, чрез които се
осъществява допълнителна персонализация, като промяна на цвета и
подравняването на определени елементи и осигуряване на отстояния
(margins).

**Сървърната част** обработва получените от потребителя данни,
отговаря на неговите заявки и извлича необходимата за правилното
функциониране на сайта информация. Тя е изградена на **Node.js**. Със
своята задвижвана от събития (event-driven) архитектура и неблокираща
входно-изходна система, Node.js значително оптимизира
производителността и мащабируемостта на дадена програма.

В допълнение към основната node.js функционалност, проектът използва и
няколко външни пакета, които я разширяват. Сред тях са **Express.js**
– уеб фреймуърк (технологична работна рамка), който улеснява
създаването на комплексни динамични уеб приложения.

Express използва т.нар. мидълуер функции (**middleware**). Това са
функции, имащи достъп до обекта на заявката (**request object (req)**)
и обектът на отговора (**response object (res)**). Тези функции могат
да изпълняват всякакъв код, да правят промени по двата обекта, да
прекратяват цикъла от заявки и отговори и да извикват следващата
мидълуер функция в стека.

Примери за такива функции, използвани в проекта, са **body-parser** –
middleware за Express.js, който позволява parse-ване на тялото на
заявка и **serve-favicon** – друг middleware, за предоставяне на
иконка (favicon) за страниците на сайта.

Други външни пакети са **jsdom**, който дава възможност за работа с
**DOM** обекти в node.js, **nodemailer** – модул за изпращане на
имейли, **sqlite3** – модул, осъществяващ връзка и позволяващ работа с
SQLite база данни и **sqlite** – разширение на sqlite3 модула,
добавящо т.нар. обещания (**promises**), представени за първи път в
**ES6** (шестата версия на ECMAScript).

**Сървърната част** се състои от следните файлове:

**server.js** – Тук се инициализира Express приложението (обектът
**app**). С негова помощ се дефинира поведението на сървъра при
различните видове заявки, като в зависимост от типа на заявката и
адреса и се генерира различен отговор. Тук става и самото стартиране
на сървъра.

**dataHandler.js** – В този файл се осъществява голяма част от
работата с данните. При стартирането на сървъра се установява връзка с
базата данни, извлича се информация за наличните радиа
(***getRadioNamesFromDB()***) и се изтеглят данните от **IceCast**
(***getIcecastData()***) и **МеtaCast** (***getMetacastData()***)
сървърите. Те предоставят нужната на уебсайта информация. Извличането
става чрез **HTTP GET** заявки, а получената информация след подходяща
обработка се съхранява в базата данни за бъдещо ползване
(***persistIcecastData(), persistMetacastData()***). Част от нея
остава налична и в паметта за по-бърз достъп. Поддържа се информация
относно статуса на достъпваните сървъри, както и времето на последния
опит за достъп. Тази информация може да бъде предоставена на клиента в
отговор на съответната заявка (***getServiceStatus(response)***).

Тук е разположена и частта от кода, която се занимава с обработката на
получената от потребителите обратна връзка
(***processFeedback(feedback)***). Тя се съхранява в базата данни. При
наличие на файл **secrets.js** в основната директория, съдържащ обект
с информация за даден STMP сървър и имейл акаунт, е възможно (чрез
модула nodemailer) изпращането на имейл на собственика на сайта при
получена обратна връзка, съдържащ информация за потребителя и неговото
съобщение.

Друга функция отговаря на AJAX заявката за текущата песен, изпълнявана
по дадено радио, като изпраща данните за песента, под формата на JSON
обект (***updateCurrentSong(token)***). Самата проверка дали песента
се е променила се осъществява от клиентската страна.

Функцията **loadMoreSongs(token, tableRows)**, както подсказва и името
ѝ, се използва, когато бъде получена заявка за визуализиране на по
старите песни, изпълнени по дадено радио, в таблицата, разположена на
неговата страница. Тя извлича нужните песни от базата данни, като
изместването (offset) се пази от клиентската страна, тъй като то е
уникално за всеки потребител и при всеки различен брой натискания на
бутона за зареждане на още песни. Осъществява се конструиране на
новата таблица, която да се присъедини, към вече заредената на сайта,
с помощта на jsdom и шаблона за това как изглежда всеки ред от
таблицата, разположен в **songlistTableLayout.html**. Финалният DOM
обект се сериализира и изпраща като отговор на заявката.

Третият основен файл, съдържащ сървърния код, е
**htmlConstructor.js**. Тук са разположени функциите, които
конструират HTML страниците, връщани като отговор на заявките на
потребителя.

Функцията **constructHTML(fileName, response, regExRadioNameCapture)**
играе ролята на маршрутизатор (**router**). В зависимост от
параметрите с които е извикана от middleware-ите на Express.js извиква
отделните функции, конструиращи различните страници на сайта.
>
Всяка една от тези функции отваря страницата, намираща се в
директорията на проекта, както и някои помощни .html файлове, променя
съдържанието ѝ и я връща като отговор, като заедно с това презаписва
старото локално копие.

**constructIndexPage(fileName, response)** изготвя началната страница,
като обновява текущото състояние на сървърите и времето на последния
опит за достъп. Цветът на елеменитете Cards от Bootstrap също се
променя динамично, чрез модифициране на техния клас.

**constructRadiosPage(fileName, response)** се грижи за създаването на
страницата, съдържаща таблица с кратка информация за наличните радиа.
За целта се извършва извличане на информацията от базата данни и
обновяване на наличната във файла таблица. Модифицират се връзките за
търсене на песента във външни услуги.

**constructConcreteRadioPage(fileName, response,
regExRadioNameCapture)** се занимава със генерирането на конкретната
страница за дадено радио. В зависимост от радиото, за което е
направена заявката, се модифицира името на страницата, както и
необходимите данни – текуща песен, изображение, лого, уебсайт и т.н.
Тук става и образуването на таблицата с последно изпълняваните песни,
която може да бъде разширена чрез заявка от потребителя.

**constructAboutPage(fileName, response)** и
**constructFeedbackPage(fileName, response)** са ангажирани
респективно със страниците за информация и за обратна връзка. Поради
статичния характер на тези две страници, функциите са по-опростени. Те
извличат съответния локален .html файл, актуализират списъка с
наличните радиа в навигационното меню и изпращат страницата без да
правят други промени.

Самото актуалазиране на списъка с радиа се извърша от функцията
**addRadiosToNavbar(dom)**. То се изпълнява и в останалите функции и с
негова помощ не се допуска потребителят да достъпи радиостанция, която
поради една или друга причина не налична в дадения момент.

При своята операция, сървърът работи с количество данни, които трябва
да бъдат съхранявани. За тяхната персистентност се използва софтуерът
**SQLite**. Това е релационна база данни с отворен код, поддържаща
стандарта SQL. Тя е реализирана като библиотека към приложения, а не
като самостоятелно работеща програма.

Концепцията на SQLite е цялата база да бъде съсредоточена в
един-единствен файл. В случая това е файлът **radio\_look.db**, който
съдържа три таблици: **radio\_info**, носеща информацията за всички
налични радиа, **song\_list**, състояща се от изпълняваните по радиата
песни и някои детайли свързани с тях, както и **user\_feedback**,
където се поместват получените от потребителите съобщения.

### 4.  Програмна реализация

Всички файлове, които са част от проекта,
могат да бъдат свободно достъпени от неговото хранилище в GitHub,
налично [**ТУК**](https://github.com/trpakov/RadioLookProject).

### 5.  Експериментални резултати

Node.js предоставя удобна среда за
разработка на сървърни приложения. Неговите простота и гъвкавост
увеличават значително продуктивността, а големият брой библиотеки
води до по-голямо удобство от страна на разработчиците.

Платформата Bootstrap комбинира HTML, CSS и JavaScript и значително
улеснява и ускорява създаването на почти всички елементи от дизайна,
необходим за съответния проект. Тя е съвместима с всички основни
браузъри, като отделя специално внимание на мобилните устройства,
предлагайки инструменти за изграждане на адаптивен дизайн, определящ
начина, по който елементите се подреждат на страницата при различните
резолюции.
>
SQLite е изключително бърза и надеждна база данни без сървърен процес.
Тя е удобна, не изисква конфигурация, работи под всякакви платформи.
Подходяща е както за по-малки уеб приложения, така и за големи
проекти. SQLite работи чудесно като база данни за малки и средни по
големина уебсайтове. Количеството трафик, с което може да се справи
зависи от това до каква степен сайтът използва базата данни. Според
официалния сайт на проекта, всеки сайт имащ по-малко от 100 хиляди
посещения на ден, не би имал проблеми, като са правени и демонстрации
с 10 пъти по-голям трафик. Създателите дават следния пример – през
2015, техният сайт получава около 400-500 хиляди HTTP заявки на ден,
като от тях близо 15-20% са за динамични страници, достъпващи базата
данни. При тях динамичното съдържание използва около 200 SQL твърдения
(statements). Сървърът се изпълнява на виртуална машина, споделяща
физически сървър с още 23 други, и въпреки това средното натоварването
остава под 0.1 през по-голямата част от времето.
